<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACAG Member Search - Complete</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<!-- QR/Barcode Scanner -->
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>

<!-- Tesseract OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>

<!-- Export Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

:root{
    --navy:#003d82;
    --navy-dark:#002a5c;
    --navy-light:#0052a3;
    --gold:#c59d5f;
    --gold-dark:#a67f42;
    --gold-light:#d4b179;
    --success:#10b981;
    --error:#ef4444;
    --bg-light:#f8fafc;
    --text-dark:#1e293b;
    --text-light:#64748b;
    --border:#e2e8f0;
}

body{
    font-family:'Inter', sans-serif;
    background:linear-gradient(135deg, var(--navy) 0%, #001f3f 50%, var(--navy-dark) 100%);
    background-attachment:fixed;
    color:var(--text-dark);
    min-height:100vh;
    padding:20px;
    opacity:0;
    animation:fadeIn 0.5s ease forwards;
    position:relative;
}

@keyframes fadeIn{
    to{opacity:1;}
}

body::before{
    content:'';
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:
        radial-gradient(circle at 20% 50%, rgba(197, 157, 95, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(197, 157, 95, 0.05) 0%, transparent 50%);
    pointer-events:none;
    z-index:0;
    animation:bgMove 20s ease-in-out infinite;
}

@keyframes bgMove{
    0%, 100%{transform:translate(0, 0);}
    50%{transform:translate(20px, -20px);}
}

/* Login Container */
.login-container{
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
    position:relative;
    z-index:1;
}

.login-container.hidden{
    display:none;
}

.login-box{
    background:white;
    border-radius:24px;
    box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.3),
        0 0 100px rgba(197, 157, 95, 0.2);
    width:100%;
    max-width:420px;
    overflow:hidden;
    animation:slideUp 0.6s ease;
}

@keyframes slideUp{
    from{
        opacity:0;
        transform:translateY(40px);
    }
    to{
        opacity:1;
        transform:translateY(0);
    }
}

.login-header{
    background:linear-gradient(135deg, var(--navy) 0%, var(--navy-dark) 100%);
    padding:40px 30px;
    text-align:center;
    position:relative;
    overflow:hidden;
}

.login-header::before{
    content:'';
    position:absolute;
    top:-50%;
    right:-50%;
    width:200%;
    height:200%;
    background:radial-gradient(circle, rgba(197, 157, 95, 0.15) 0%, transparent 70%);
    animation:rotate 15s linear infinite;
}

@keyframes rotate{
    from{transform:rotate(0deg);}
    to{transform:rotate(360deg);}
}

.login-logo{
    width:80px;
    height:80px;
    margin:0 auto 20px;
    background:linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:2.5rem;
    color:white;
    position:relative;
    z-index:1;
    box-shadow:0 10px 40px rgba(197, 157, 95, 0.4);
    animation:float 3s ease-in-out infinite;
}

@keyframes float{
    0%, 100%{transform:translateY(0);}
    50%{transform:translateY(-10px);}
}

.login-title{
    color:white;
    font-size:1.8rem;
    font-weight:800;
    margin-bottom:8px;
    position:relative;
    z-index:1;
}

.login-subtitle{
    color:var(--gold-light);
    font-size:1rem;
    position:relative;
    z-index:1;
}

.login-body{
    padding:35px 30px;
}

.form-group{
    margin-bottom:25px;
}

.form-label{
    display:block;
    color:var(--navy);
    font-weight:700;
    margin-bottom:10px;
    font-size:0.95rem;
}

.input-wrapper{
    position:relative;
}

.input-icon{
    position:absolute;
    left:16px;
    top:50%;
    transform:translateY(-50%);
    color:var(--text-light);
    font-size:1.2rem;
}

.form-input{
    width:100%;
    padding:15px 50px;
    border:2px solid var(--border);
    border-radius:12px;
    font-size:1rem;
    transition:all 0.3s;
    background:var(--bg-light);
    font-family:inherit;
}

.form-input:focus{
    outline:none;
    border-color:var(--navy);
    background:white;
    box-shadow:0 0 0 4px rgba(0, 61, 130, 0.1);
}

.password-toggle{
    position:absolute;
    right:16px;
    top:50%;
    transform:translateY(-50%);
    background:none;
    border:none;
    cursor:pointer;
    color:var(--text-light);
    font-size:1.1rem;
    padding:5px;
    transition:color 0.3s;
}

.password-toggle:hover{
    color:var(--navy);
}

.remember-me{
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:25px;
}

.remember-me input[type="checkbox"]{
    width:18px;
    height:18px;
    cursor:pointer;
}

.remember-me label{
    color:var(--text-dark);
    font-size:0.95rem;
    cursor:pointer;
}

.alert{
    padding:15px;
    border-radius:12px;
    margin-bottom:20px;
    display:none;
    animation:slideDown 0.3s ease;
}

@keyframes slideDown{
    from{
        opacity:0;
        transform:translateY(-10px);
    }
    to{
        opacity:1;
        transform:translateY(0);
    }
}

.alert.show{
    display:block;
}

.alert-error{
    background:#fee2e2;
    color:var(--error);
    border:1px solid #fecaca;
}

.btn-login{
    width:100%;
    padding:16px;
    background:linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
    color:white;
    border:none;
    border-radius:12px;
    font-size:1.1rem;
    font-weight:700;
    cursor:pointer;
    transition:all 0.3s;
    font-family:inherit;
    box-shadow:0 4px 20px rgba(0, 61, 130, 0.4);
}

.btn-login:hover:not(:disabled){
    transform:translateY(-2px);
    box-shadow:0 6px 30px rgba(0, 61, 130, 0.5);
}

.btn-login:disabled{
    opacity:0.6;
    cursor:not-allowed;
}

/* Main App */
.container{
    max-width:1200px;
    margin:0 auto;
    position:relative;
    z-index:1;
    display:none;
}

.container.active{
    display:block;
}

/* User Header */
.user-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:30px;
    animation:slideDown 0.6s ease;
}

.user-info{
    display:flex;
    align-items:center;
    gap:15px;
    background:rgba(255, 255, 255, 0.1);
    backdrop-filter:blur(10px);
    padding:12px 20px;
    border-radius:100px;
    border:1px solid rgba(255, 255, 255, 0.2);
}

.user-avatar{
    width:45px;
    height:45px;
    background:linear-gradient(135deg, var(--gold), var(--gold-light));
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:800;
    font-size:1.2rem;
}

.user-details h3{
    color:white;
    font-size:1rem;
    font-weight:700;
}

.user-details p{
    color:var(--gold-light);
    font-size:0.85rem;
}

.btn-logout{
    padding:12px 24px;
    background:rgba(239, 68, 68, 0.15);
    color:#ff6b6b;
    border:1px solid rgba(239, 68, 68, 0.3);
    border-radius:100px;
    font-size:0.9rem;
    font-weight:700;
    cursor:pointer;
    transition:all 0.3s;
    font-family:inherit;
}

.btn-logout:hover{
    background:rgba(239, 68, 68, 0.25);
    transform:translateY(-2px);
}

/* Header */
.header{
    text-align:center;
    margin-bottom:40px;
    animation:slideUp 0.6s ease;
}

.logo{
    width:90px;
    height:90px;
    margin:0 auto 20px;
    background:linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:2.5rem;
    color:white;
    box-shadow:
        0 10px 30px rgba(197, 157, 95, 0.4),
        0 0 60px rgba(197, 157, 95, 0.2);
    animation:float 3s ease-in-out infinite;
    position:relative;
}

.logo::before{
    content:'';
    position:absolute;
    inset:-4px;
    background:linear-gradient(135deg, var(--gold), var(--gold-light));
    border-radius:50%;
    filter:blur(15px);
    opacity:0.5;
    z-index:-1;
    animation:pulse 2s ease-in-out infinite;
}

@keyframes pulse{
    0%, 100%{opacity:0.5; transform:scale(1);}
    50%{opacity:0.8; transform:scale(1.1);}
}

h1{
    color:white;
    font-size:2.8rem;
    font-weight:800;
    margin-bottom:10px;
    text-shadow:0 4px 20px rgba(0, 0, 0, 0.3);
}

.subtitle{
    color:var(--gold-light);
    font-size:1.2rem;
    font-weight:500;
}

/* Card */
.card{
    background:white;
    border-radius:20px;
    padding:35px;
    box-shadow:
        0 10px 40px rgba(0, 0, 0, 0.2),
        0 0 100px rgba(197, 157, 95, 0.1);
    margin-bottom:25px;
    border:1px solid rgba(197, 157, 95, 0.15);
    position:relative;
    animation:slideUp 0.6s ease backwards;
}

.card:nth-child(3){animation-delay:0.1s;}
.card:nth-child(4){animation-delay:0.2s;}
.card:nth-child(5){animation-delay:0.3s;}

.card::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    right:0;
    height:4px;
    background:linear-gradient(90deg, var(--gold), var(--gold-light), var(--gold));
    border-radius:20px 20px 0 0;
}

/* Status Card */
.status{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
}

.status-info{
    display:flex;
    align-items:center;
    gap:18px;
}

.status-icon{
    width:60px;
    height:60px;
    background:linear-gradient(135deg, rgba(0, 61, 130, 0.1), rgba(0, 82, 163, 0.1));
    border:2px solid rgba(0, 61, 130, 0.2);
    border-radius:16px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:30px;
    animation:bounce 2.5s ease-in-out infinite;
}

@keyframes bounce{
    0%, 100%{transform:scale(1) translateY(0);}
    50%{transform:scale(1.08) translateY(-5px);}
}

.status-text h3{
    font-size:1.1rem;
    font-weight:700;
    color:var(--navy);
    margin-bottom:5px;
}

.status-text p{
    font-size:0.9rem;
    color:var(--text-light);
    font-family:monospace;
}

.badge{
    padding:10px 20px;
    border-radius:100px;
    font-size:0.9rem;
    font-weight:700;
    display:flex;
    align-items:center;
    gap:8px;
    text-transform:uppercase;
    letter-spacing:0.5px;
}

.badge.loading{
    background:linear-gradient(135deg, rgba(0, 61, 130, 0.15), rgba(0, 82, 163, 0.15));
    color:var(--navy);
    border:1px solid rgba(0, 61, 130, 0.2);
}

.badge.success{
    background:linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(5, 150, 105, 0.15));
    color:var(--success);
    border:1px solid rgba(16, 185, 129, 0.2);
}

.badge.error{
    background:linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.15));
    color:var(--error);
    border:1px solid rgba(239, 68, 68, 0.2);
}

.spinner{
    width:16px;
    height:16px;
    border:2.5px solid currentColor;
    border-top-color:transparent;
    border-radius:50%;
    animation:spin 0.7s linear infinite;
}

@keyframes spin{
    to{transform:rotate(360deg);}
}

/* Search Section */
.card-title{
    color:var(--navy);
    font-size:1.6rem;
    font-weight:800;
    margin-bottom:25px;
    display:flex;
    align-items:center;
    gap:12px;
}

.card-title::before{
    content:'üîç';
    font-size:1.8rem;
}

.search-box{
    display:flex;
    gap:15px;
    margin-bottom:20px;
}

.input-group{
    flex:1;
}

label{
    display:block;
    font-size:0.95rem;
    font-weight:700;
    margin-bottom:10px;
    color:var(--navy);
}

input[type="text"]{
    width:100%;
    padding:16px 20px;
    font-size:1.05rem;
    font-family:monospace;
    font-weight:600;
    background:var(--bg-light);
    border:2px solid var(--border);
    border-radius:14px;
    color:var(--text-dark);
    transition:all 0.3s ease;
}

input[type="text"]:focus{
    outline:none;
    border-color:var(--navy);
    background:white;
    box-shadow:
        0 0 0 4px rgba(0, 61, 130, 0.1),
        0 4px 20px rgba(0, 61, 130, 0.15);
    transform:translateY(-2px);
}

input[type="text"]::placeholder{
    color:var(--text-light);
    font-weight:400;
}

button.search-btn{
    align-self:flex-end;
    padding:16px 40px;
    background:linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
    color:white;
    border:none;
    border-radius:14px;
    font-size:1.05rem;
    font-weight:700;
    cursor:pointer;
    transition:all 0.3s ease;
    font-family:inherit;
    box-shadow:0 4px 20px rgba(0, 61, 130, 0.4);
    white-space:nowrap;
}

button.search-btn:hover:not(:disabled){
    background:linear-gradient(135deg, var(--navy-light) 0%, #0066cc 100%);
    transform:translateY(-3px);
    box-shadow:0 6px 30px rgba(0, 61, 130, 0.5);
}

button.search-btn:active{
    transform:translateY(-1px);
}

button.search-btn:disabled{
    opacity:0.6;
    cursor:not-allowed;
}

/* Advanced Tools */
.tools-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
    gap:15px;
}

.tool-btn{
    padding:18px 24px;
    background:linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
    color:white;
    border:none;
    border-radius:14px;
    font-size:1rem;
    font-weight:700;
    cursor:pointer;
    transition:all 0.3s ease;
    font-family:inherit;
    box-shadow:0 4px 20px rgba(197, 157, 95, 0.4);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
}

.tool-btn:hover{
    background:linear-gradient(135deg, var(--gold-light) 0%, var(--gold) 100%);
    transform:translateY(-3px);
    box-shadow:0 6px 30px rgba(197, 157, 95, 0.5);
}

.tool-btn.voice-btn{
    background:linear-gradient(135deg, #8b5cf6, #a855f7);
}

.tool-btn.voice-btn:hover{
    background:linear-gradient(135deg, #a855f7, #8b5cf6);
}

.tool-btn.voice-btn.listening{
    animation:pulseVoice 1s ease-in-out infinite;
}

@keyframes pulseVoice{
    0%, 100%{transform:scale(1);}
    50%{transform:scale(1.05);}
}

/* Modal */
.modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgba(0, 0, 0, 0.9);
    z-index:9999;
    justify-content:center;
    align-items:center;
    padding:20px;
}

.modal.active{
    display:flex;
}

.modal-content{
    background:white;
    border-radius:20px;
    padding:30px;
    max-width:600px;
    width:100%;
    box-shadow:0 20px 60px rgba(0, 0, 0, 0.5);
    animation:slideUp 0.4s ease;
    max-height:90vh;
    overflow-y:auto;
}

.modal-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
}

.modal-header h3{
    color:var(--navy);
    font-size:1.5rem;
    font-weight:800;
}

.btn-close{
    background:var(--error);
    color:white;
    border:none;
    width:40px;
    height:40px;
    border-radius:50%;
    cursor:pointer;
    font-size:1.3rem;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all 0.3s;
}

.btn-close:hover{
    transform:scale(1.1);
}

#reader{
    width:100%;
    border-radius:12px;
    overflow:hidden;
}

.modal-info{
    margin-top:20px;
    padding:15px;
    background:var(--bg-light);
    border-radius:12px;
    color:var(--text-light);
    font-size:0.9rem;
    text-align:center;
}

/* OCR Section */
#ocrPreview{
    width:100%;
    max-height:400px;
    border-radius:12px;
    margin-bottom:20px;
    display:none;
}

.ocr-input{
    width:100%;
    padding:40px 20px;
    border:2px dashed var(--border);
    border-radius:12px;
    text-align:center;
    cursor:pointer;
    transition:all 0.3s;
    background:var(--bg-light);
}

.ocr-input:hover{
    border-color:var(--navy);
    background:white;
}

.ocr-progress{
    margin-top:20px;
    display:none;
}

.progress-bar{
    width:100%;
    height:10px;
    background:var(--border);
    border-radius:5px;
    overflow:hidden;
}

.progress-fill{
    height:100%;
    background:linear-gradient(90deg, var(--navy), var(--gold));
    transition:width 0.3s;
    width:0%;
}

.progress-text{
    text-align:center;
    margin-top:12px;
    color:var(--text-light);
    font-size:0.95rem;
    font-weight:600;
}

/* Results */
.results-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:25px;
    flex-wrap:wrap;
    gap:15px;
}

.results-header h2{
    color:var(--navy);
    font-size:1.6rem;
    font-weight:800;
}

.results-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
}

.action-btn{
    padding:10px 20px;
    background:var(--bg-light);
    border:2px solid var(--border);
    border-radius:10px;
    color:var(--navy);
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s;
    font-size:0.9rem;
}

.action-btn:hover{
    background:white;
    border-color:var(--navy);
    transform:translateY(-2px);
}

.count{
    color:var(--text-light);
    font-weight:700;
    font-size:1rem;
}

/* Table */
.table-wrapper{
    overflow-x:auto;
    border-radius:14px;
    border:2px solid var(--border);
}

table{
    width:100%;
    border-collapse:collapse;
}

thead{
    background:linear-gradient(135deg, var(--navy) 0%, var(--navy-dark) 100%);
}

th{
    padding:18px 20px;
    text-align:left;
    font-size:0.85rem;
    font-weight:800;
    color:var(--gold-light);
    text-transform:uppercase;
    letter-spacing:1px;
}

tbody tr{
    border-bottom:1px solid var(--border);
    transition:all 0.25s ease;
    animation:fadeInRow 0.4s ease backwards;
}

@keyframes fadeInRow{
    from{
        opacity:0;
        transform:translateX(-20px);
    }
    to{
        opacity:1;
        transform:translateX(0);
    }
}

tbody tr:hover{
    background:linear-gradient(90deg, rgba(0, 61, 130, 0.03), transparent);
    transform:translateX(5px);
}

tbody tr:last-child{
    border-bottom:none;
}

td{
    padding:18px 20px;
    font-size:0.95rem;
    color:var(--text-dark);
}

td:first-child{
    font-family:monospace;
    font-weight:700;
    color:var(--navy);
}

td:nth-child(2){
    font-family:monospace;
    color:var(--navy-light);
}

/* States */
.state{
    padding:100px 40px;
    text-align:center;
}

.state-icon{
    font-size:70px;
    margin-bottom:25px;
    display:inline-block;
    animation:bounce 2.5s ease-in-out infinite;
}

.state h3{
    font-size:1.5rem;
    font-weight:800;
    color:var(--navy);
    margin-bottom:10px;
}

.state p{
    color:var(--text-light);
    font-size:1.05rem;
}

.loading-icon{
    width:70px;
    height:70px;
    border:5px solid var(--border);
    border-top-color:var(--navy);
    border-right-color:var(--gold);
    border-radius:50%;
    margin:0 auto 25px;
    animation:spin 1s linear infinite;
}

/* Responsive */
@media(max-width:768px){
    body{padding:15px;}
    
    h1{font-size:2rem;}
    
    .card{padding:25px;}
    
    .user-header{
        flex-direction:column;
        gap:15px;
    }
    
    .status{
        flex-direction:column;
        text-align:center;
    }
    
    .search-box{
        flex-direction:column;
    }
    
    button.search-btn{
        width:100%;
    }
    
    .tools-grid{
        grid-template-columns:1fr;
    }
    
    .results-header{
        flex-direction:column;
        align-items:flex-start;
        gap:12px;
    }
    
    .results-actions{
        width:100%;
    }
    
    .action-btn{
        flex:1;
    }
    
    table{font-size:0.85rem;}
    
    th, td{padding:12px 15px;}
}

/* Custom Scrollbar */
::-webkit-scrollbar{
    width:10px;
    height:10px;
}

::-webkit-scrollbar-track{
    background:var(--bg-light);
}

::-webkit-scrollbar-thumb{
    background:linear-gradient(135deg, var(--navy), var(--gold));
    border-radius:5px;
}

::-webkit-scrollbar-thumb:hover{
    background:linear-gradient(135deg, var(--gold), var(--navy));
}
</style>
</head>

<body>

<!-- Login Container -->
<div class="login-container" id="loginContainer">
    <div class="login-box">
        <div class="login-header">
            <div class="login-logo">üîê</div>
            <h2 class="login-title">ACAG Login</h2>
            <p class="login-subtitle">Secure Member Search System</p>
        </div>
        
        <div class="login-body">
            <div class="alert alert-error" id="loginError"></div>
            
            <div class="form-group">
                <label class="form-label">Username</label>
                <div class="input-wrapper">
                    <span class="input-icon">üë§</span>
                    <input 
                        type="text" 
                        id="username"
                        class="form-input"
                        placeholder="Enter username"
                        autocomplete="off"
                    >
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="input-wrapper">
                    <span class="input-icon">üîí</span>
                    <input 
                        type="password" 
                        id="password"
                        class="form-input"
                        placeholder="Enter password"
                    >
                    <button class="password-toggle" onclick="togglePassword()">
                        <span id="eyeIcon">üëÅÔ∏è</span>
                    </button>
                </div>
            </div>
            
            <div class="remember-me">
                <input type="checkbox" id="rememberMe" checked>
                <label for="rememberMe">Keep me logged in on this device</label>
            </div>
            
            <button class="btn-login" onclick="login()">
                <span id="loginBtnText">Login</span>
            </button>
        </div>
    </div>
</div>

<!-- Scanner Modal -->
<div class="modal" id="scannerModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üì∑ Scan Barcode/QR</h3>
            <button class="btn-close" onclick="stopScanner()">√ó</button>
        </div>
        <div id="reader"></div>
        <div class="modal-info">
            üì± Position barcode/QR code within the frame
        </div>
    </div>
</div>

<!-- OCR Modal -->
<div class="modal" id="ocrModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üì∏ Extract CNIC from Photo</h3>
            <button class="btn-close" onclick="stopOCR()">√ó</button>
        </div>
        
        <input type="file" id="imageInput" accept="image/*" capture="environment" style="display:none;" onchange="processImage(event)">
        
        <div class="ocr-input" onclick="document.getElementById('imageInput').click()">
            <p style="font-size:3rem;margin-bottom:15px;">üì∏</p>
            <p style="font-weight:600;font-size:1.1rem;margin-bottom:8px;">Take Photo or Upload Image</p>
            <p style="font-size:0.9rem;color:var(--text-light);">Click to capture CNIC card</p>
        </div>
        
        <img id="ocrPreview" alt="Preview">
        
        <div class="ocr-progress" id="ocrProgress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">Processing...</p>
        </div>
        
        <div class="modal-info">
            üí° Make sure CNIC number is clearly visible and well-lit
        </div>
    </div>
</div>

<!-- Main App -->
<div class="container" id="mainApp">

<!-- User Header -->
<div class="user-header">
    <div class="user-info">
        <div class="user-avatar" id="userAvatar">A</div>
        <div class="user-details">
            <h3 id="displayUsername">Admin User</h3>
            <p>Member Search Access</p>
        </div>
    </div>
    <button class="btn-logout" onclick="logout()">üö™ Logout</button>
</div>

<!-- Header -->
<div class="header">
    <div class="logo">üîç</div>
    <h1>ACAG Member Search</h1>
    <p class="subtitle">Advanced Database Search System</p>
</div>

<!-- Status Card -->
<div class="card">
    <div class="status">
        <div class="status-info">
            <div class="status-icon">üìä</div>
            <div class="status-text">
                <h3>Database Connection</h3>
                <p id="statusInfo">Initializing connection...</p>
            </div>
        </div>
        <div class="badge loading" id="statusBadge">
            <span class="spinner"></span>
            <span>Loading</span>
        </div>
    </div>
</div>

<!-- Search Card -->
<div class="card">
    <h2 class="card-title">Search by CNIC</h2>
    <div class="search-box">
        <div class="input-group">
            <label>Enter CNIC Number</label>
            <input 
                type="text" 
                id="cnicInput"
                placeholder="XXXXX-XXXXXXX-X"
                maxlength="15"
                autocomplete="off"
            >
        </div>
        <button class="search-btn" id="searchBtn" onclick="search()">
            <span id="btnText">üîç Search</span>
        </button>
    </div>
    
    <div class="tools-grid">
        <button class="tool-btn" onclick="startScanner()">
            üì∑ Scan Barcode/QR
        </button>
        <button class="tool-btn" onclick="startOCR()">
            üì∏ Extract from Photo
        </button>
        <button class="tool-btn voice-btn" id="voiceBtn" onclick="startVoice()">
            <span id="voiceIcon">üé§</span>
            <span id="voiceText">Voice Search</span>
        </button>
    </div>
</div>

<!-- Results Card -->
<div class="card">
    <div class="results-header">
        <h2>Search Results</h2>
        <div class="results-actions">
            <button class="action-btn" onclick="copyResults()">üìã Copy</button>
            <button class="action-btn" onclick="exportExcel()">üìä Excel</button>
            <button class="action-btn" onclick="exportPDF()">üìÑ PDF</button>
            <button class="action-btn" onclick="printResults()">üñ®Ô∏è Print</button>
            <button class="action-btn" onclick="shareResults()">üì§ Share</button>
        </div>
        <div class="count" id="resultCount">Ready to search</div>
    </div>
    
    <div class="table-wrapper">
        <table>
            <tbody id="results">
                <tr>
                    <td colspan="7" class="state">
                        <div class="state-icon">üîç</div>
                        <h3>Ready to Search</h3>
                        <p>Use any search method above</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

</div>

<script>
// Config
const SHEET_ID = "1WxFeeRY5X8KaMAmZjogReKFHZaWi8We3";
const SHEET_NAME = "Sheet1";

// Demo credentials (hidden)
const VALID_USERS = {
    'admin': 'acag2026',
    'user': 'user123',
    'demo': 'demo123'
};

// State
let data = [];
let ready = false;
let currentUser = null;
let currentResults = [];
let html5QrCode = null;
let recognition = null;

// Check persistent login (localStorage for persistent, sessionStorage for session-only)
window.onload = () => {
    // Check localStorage first (persistent login)
    const persistentUser = localStorage.getItem('acag_user_persistent');
    if(persistentUser){
        currentUser = persistentUser;
        showApp();
        return;
    }
    
    // Then check sessionStorage (session-only login)
    const sessionUser = sessionStorage.getItem('acag_user');
    if(sessionUser){
        currentUser = sessionUser;
        showApp();
        return;
    }
    
    // No login found, show login screen
    document.getElementById('username').focus();
};

// Toggle password
function togglePassword(){
    const input = document.getElementById('password');
    const icon = document.getElementById('eyeIcon');
    
    if(input.type === 'password'){
        input.type = 'text';
        icon.textContent = 'üôà';
    }else{
        input.type = 'password';
        icon.textContent = 'üëÅÔ∏è';
    }
}

// Login
function login(){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const rememberMe = document.getElementById('rememberMe').checked;
    const errorEl = document.getElementById('loginError');
    const btnText = document.getElementById('loginBtnText');
    
    errorEl.classList.remove('show');
    
    if(!username || !password){
        errorEl.textContent = '‚ö†Ô∏è Please enter both username and password';
        errorEl.classList.add('show');
        return;
    }
    
    if(VALID_USERS[username] && VALID_USERS[username] === password){
        btnText.textContent = '‚úì Logging in...';
        
        setTimeout(() => {
            currentUser = username;
            
            // Save to localStorage if "Keep me logged in" is checked
            if(rememberMe){
                localStorage.setItem('acag_user_persistent', username);
            }else{
                // Otherwise save to sessionStorage only
                sessionStorage.setItem('acag_user', username);
            }
            
            showApp();
        }, 800);
    }else{
        errorEl.textContent = '‚ùå Invalid username or password';
        errorEl.classList.add('show');
    }
}

// Logout
function logout(){
    if(confirm('Are you sure you want to logout?')){
        currentUser = null;
        
        // Remove from both localStorage and sessionStorage
        localStorage.removeItem('acag_user_persistent');
        sessionStorage.removeItem('acag_user');
        
        document.getElementById('mainApp').classList.remove('active');
        document.getElementById('loginContainer').classList.remove('hidden');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('loginBtnText').textContent = 'Login';
    }
}

// Show app
async function showApp(){
    document.getElementById('loginContainer').classList.add('hidden');
    document.getElementById('mainApp').classList.add('active');
    
    const avatar = document.getElementById('userAvatar');
    const display = document.getElementById('displayUsername');
    avatar.textContent = currentUser.charAt(0).toUpperCase();
    display.textContent = currentUser.charAt(0).toUpperCase() + currentUser.slice(1);
    
    await loadData();
    document.getElementById('cnicInput').focus();
}

// Enter key for login
document.addEventListener('keypress', e => {
    if(e.key === 'Enter' && !document.getElementById('loginContainer').classList.contains('hidden')){
        login();
    }
});

// ===========================================
// BARCODE/QR SCANNER
// ===========================================
function startScanner(){
    document.getElementById('scannerModal').classList.add('active');
    
    html5QrCode = new Html5Qrcode("reader");
    
    Html5Qrcode.getCameras().then(cameras => {
        if(cameras && cameras.length){
            html5QrCode.start(
                { facingMode: "environment" },
                { fps: 10, qrbox: { width: 250, height: 250 } },
                onScanSuccess,
                () => {}
            ).catch(() => {
                alert("Unable to start camera. Please check permissions.");
                stopScanner();
            });
        }else{
            alert("No camera found on this device.");
            stopScanner();
        }
    }).catch(() => {
        alert("Camera permission denied. Please enable camera access.");
        stopScanner();
    });
}

function stopScanner(){
    if(html5QrCode){
        html5QrCode.stop().then(() => {
            document.getElementById('scannerModal').classList.remove('active');
        }).catch(() => {
            document.getElementById('scannerModal').classList.remove('active');
        });
    }else{
        document.getElementById('scannerModal').classList.remove('active');
    }
}

function onScanSuccess(decodedText){
    const patterns = [
        /\d{13}/,
        /\d{5}[\s-]?\d{7}[\s-]?\d/,
        /(\d{5}).*?(\d{7}).*?(\d)/
    ];
    
    let cnicMatch = null;
    for(let pattern of patterns){
        cnicMatch = decodedText.match(pattern);
        if(cnicMatch) break;
    }
    
    if(cnicMatch){
        const cnic = cnicMatch[0].replace(/\D/g, '');
        if(cnic.length >= 13){
            fillCNIC(cnic.slice(0, 13));
            stopScanner();
            setTimeout(() => search(), 500);
        }
    }
}

// ===========================================
// OCR TEXT EXTRACTION
// ===========================================
function startOCR(){
    document.getElementById('ocrModal').classList.add('active');
    document.getElementById('ocrPreview').style.display = 'none';
    document.getElementById('ocrProgress').style.display = 'none';
}

function stopOCR(){
    document.getElementById('ocrModal').classList.remove('active');
    document.getElementById('imageInput').value = '';
}

async function processImage(event){
    const file = event.target.files[0];
    if(!file) return;
    
    const preview = document.getElementById('ocrPreview');
    const progress = document.getElementById('ocrProgress');
    const fill = document.getElementById('progressFill');
    const text = document.getElementById('progressText');
    
    preview.src = URL.createObjectURL(file);
    preview.style.display = 'block';
    progress.style.display = 'block';
    
    try{
        text.textContent = 'Processing image...';
        fill.style.width = '10%';
        
        const result = await Tesseract.recognize(
            file,
            'eng',
            {
                logger: m => {
                    if(m.status === 'recognizing text'){
                        const percent = Math.round(m.progress * 90) + 10;
                        fill.style.width = percent + '%';
                        text.textContent = `Processing... ${percent}%`;
                    }
                }
            }
        );
        
        fill.style.width = '100%';
        text.textContent = 'Extracting CNIC...';
        
        const extractedText = result.data.text;
        const patterns = [
            /\d{5}[\s-]?\d{7}[\s-]?\d/g,
            /\d{13}/g
        ];
        
        let cnic = null;
        for(let pattern of patterns){
            const matches = extractedText.match(pattern);
            if(matches){
                cnic = matches[0].replace(/\D/g, '');
                if(cnic.length >= 13){
                    cnic = cnic.slice(0, 13);
                    break;
                }
            }
        }
        
        if(cnic && cnic.length === 13){
            fill.style.width = '100%';
            text.textContent = '‚úì CNIC Found!';
            
            setTimeout(() => {
                fillCNIC(cnic);
                stopOCR();
                setTimeout(() => search(), 500);
            }, 1000);
        }else{
            text.textContent = '‚ùå No valid CNIC found. Please try again.';
            fill.style.width = '0%';
        }
        
    }catch(err){
        console.error('OCR Error:', err);
        text.textContent = '‚ùå Processing failed. Please try again.';
        fill.style.width = '0%';
    }
}

// ===========================================
// VOICE SEARCH
// ===========================================
function startVoice(){
    if(!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)){
        alert('Voice recognition not supported in this browser.\n\nSupported browsers:\n‚Ä¢ Chrome\n‚Ä¢ Edge\n‚Ä¢ Safari (iOS 14.5+)');
        return;
    }
    
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    
    recognition.lang = 'en-US';
    recognition.continuous = false;
    recognition.interimResults = false;
    
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceIcon = document.getElementById('voiceIcon');
    const voiceText = document.getElementById('voiceText');
    
    voiceBtn.classList.add('listening');
    voiceIcon.textContent = 'üéôÔ∏è';
    voiceText.textContent = 'Listening...';
    
    recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        
        const digitMap = {
            'zero': '0', 'one': '1', 'two': '2', 'three': '3', 'four': '4',
            'five': '5', 'six': '6', 'seven': '7', 'eight': '8', 'nine': '9',
            'to': '2', 'for': '4', 'too': '2'
        };
        
        let digits = transcript.replace(/[^\d]/g, '');
        
        const words = transcript.split(/\s+/);
        words.forEach(word => {
            if(digitMap[word]) digits += digitMap[word];
        });
        
        if(digits.length >= 13){
            const cnic = digits.slice(0, 13);
            fillCNIC(cnic);
            setTimeout(() => search(), 500);
        }else if(digits.length > 0){
            alert(`Captured ${digits.length} digits. Please speak all 13 digits clearly.`);
        }
        
        voiceBtn.classList.remove('listening');
        voiceIcon.textContent = 'üé§';
        voiceText.textContent = 'Voice Search';
    };
    
    recognition.onerror = (event) => {
        voiceBtn.classList.remove('listening');
        voiceIcon.textContent = 'üé§';
        voiceText.textContent = 'Voice Search';
        
        let errorMsg = 'Voice recognition failed.';
        if(event.error === 'no-speech'){
            errorMsg = 'No speech detected. Please try again.';
        }else if(event.error === 'not-allowed'){
            errorMsg = 'Microphone permission denied.';
        }
        alert(errorMsg);
    };
    
    recognition.onend = () => {
        voiceBtn.classList.remove('listening');
        voiceIcon.textContent = 'üé§';
        voiceText.textContent = 'Voice Search';
    };
    
    recognition.start();
}

// ===========================================
// HELPER FUNCTIONS
// ===========================================
function fillCNIC(cnic){
    document.getElementById('cnicInput').value = formatCNIC(cnic);
}

function formatCNIC(cnic){
    let formatted = cnic;
    if(formatted.length > 5) formatted = formatted.slice(0, 5) + "-" + formatted.slice(5);
    if(formatted.length > 13) formatted = formatted.slice(0, 13) + "-" + formatted.slice(13);
    return formatted;
}

// ===========================================
// DATA LOADING
// ===========================================
async function loadData(){
    const badge = document.getElementById("statusBadge");
    const info = document.getElementById("statusInfo");
    
    try{
        // Step 1: Connecting
        badge.className = "badge loading";
        badge.innerHTML = '<span class="spinner"></span><span>Connecting</span>';
        info.textContent = "Connecting to Google Sheets...";
        
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
        const start = performance.now();
        
        // Add 30-second timeout
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 30000);
        
        const res = await fetch(url, {
            method: 'GET',
            cache: 'no-cache',
            mode: 'cors',
            signal: controller.signal
        });
        clearTimeout(timeoutId);
        
        if(!res.ok) throw new Error("Connection failed");
        
        // Step 2: Loading
        badge.innerHTML = '<span class="spinner"></span><span>Loading</span>';
        info.textContent = "Downloading data from Google Sheets...";
        
        const csv = await res.text();
        
        // Step 3: Processing with progress
        badge.innerHTML = '<span class="spinner"></span><span>Processing</span>';
        info.textContent = "Processing data...";
        
        // Parse CSV in chunks to avoid UI freeze
        await new Promise(resolve => setTimeout(resolve, 10));
        
        const lines = csv.split("\n").filter(l => l.trim());
        data = [];
        
        for(let i = 0; i < lines.length; i++){
            if(i % 10000 === 0 && i > 0){
                const progress = Math.round((i / lines.length) * 100);
                badge.innerHTML = `<span class="spinner"></span><span>Processing ${progress}%</span>`;
                await new Promise(resolve => setTimeout(resolve, 0));
            }
            
            const line = lines[i];
            const cells = [];
            let cell = '';
            let quoted = false;
            
            for(let j = 0; j < line.length; j++){
                const c = line[j];
                const next = line[j + 1];
                
                if(c === '"'){
                    if(quoted && next === '"'){
                        cell += '"';
                        j++;
                    }else{
                        quoted = !quoted;
                    }
                }else if(c === ',' && !quoted){
                    cells.push(cell.trim());
                    cell = '';
                }else{
                    cell += c;
                }
            }
            cells.push(cell.trim());
            data.push(cells);
        }
        
        const time = Math.round(performance.now() - start);
        ready = true;
        
        const count = data.length - 1;
        
        // Step 4: Connected
        badge.className = "badge success";
        badge.innerHTML = '<span>‚úì</span><span>Connected</span>';
        info.innerHTML = `<strong>${count.toLocaleString()}</strong> records loaded in <strong>${time}ms</strong>`;
        
        // Show final state after 2 seconds
        setTimeout(() => {
            badge.innerHTML = `<span>‚úì</span><span>${count.toLocaleString()} Records</span>`;
        }, 2000);
        
    }catch(err){
        badge.className = "badge error";
        
        if(err.name === 'AbortError'){
            badge.innerHTML = '<span>‚ö†</span><span>Timeout</span>';
            info.textContent = "Connection timed out after 30 seconds. Please try again.";
            alert('‚ùå Connection Timeout\n\nThe connection took too long. Please check:\n1. Your internet connection\n2. Google Sheets link is accessible\n3. Try again in a few moments');
        }else{
            badge.innerHTML = '<span>‚ö†</span><span>Failed</span>';
            info.textContent = "Connection failed. Please refresh.";
            alert('‚ùå Failed to connect to database\n\nPlease check:\n1. Google Sheet is shared (Anyone with link can view)\n2. Internet connection is working\n3. Sheet ID is correct');
        }
    }
}

// ===========================================
// SEARCH
// ===========================================
function search(){
    if(!ready){
        showError("Database not loaded. Please wait...");
        return;
    }
    
    const input = document.getElementById("cnicInput").value.trim();
    const btn = document.getElementById("searchBtn");
    const btnText = document.getElementById("btnText");
    const count = document.getElementById("resultCount");
    
    const cnic = input.replace(/\D/g, "");
    
    if(cnic.length !== 13){
        showError("Please enter a valid 13-digit CNIC");
        return;
    }
    
    btn.disabled = true;
    btnText.textContent = "‚è≥ Searching";
    showLoading();
    
    // Use requestAnimationFrame for smoother UI
    requestAnimationFrame(() => {
        setTimeout(() => {
            try{
                const start = performance.now();
                console.log('Searching for CNIC:', cnic, 'in', data.length - 1, 'rows');
                
                // Optimized search
                const results = [];
                const rows = data.slice(1);
                
                for(let i = 0; i < rows.length; i++){
                    const rowCnic = rows[i][1].replace(/\D/g, "");
                    if(rowCnic === cnic){
                        results.push(rows[i]);
                    }
                }
                
                const time = Math.round(performance.now() - start);
                console.log('Found results:', results.length, 'in', time, 'ms');
                
                btn.disabled = false;
                btnText.textContent = "üîç Search";
                
                if(results.length === 0){
                    alert('‚ùå NO DATA FOUND\n\nThe CNIC you entered is not in the database.');
                    showNoResults();
                    count.textContent = "No results found";
                }else{
                    currentResults = results;
                    showResults(results);
                    count.textContent = `${results.length} record(s) found in ${time}ms`;
                }
            }catch(err){
                console.error('Search Error:', err);
                btn.disabled = false;
                btnText.textContent = "üîç Search";
                alert('‚ùå Search Error\n\nAn error occurred during search. Please try again.');
                showError("Search failed. Please try again.");
            }
        }, 50);
    });
}

// ===========================================
// DISPLAY FUNCTIONS
// ===========================================
function showLoading(){
    document.getElementById("results").innerHTML = `
        <tr>
            <td colspan="7" class="state">
                <div class="loading-icon"></div>
                <h3>Searching Database...</h3>
                <p>Please wait</p>
            </td>
        </tr>`;
}

function showNoResults(){
    document.getElementById("results").innerHTML = `
        <tr>
            <td colspan="7" class="state">
                <div class="state-icon">‚ùå</div>
                <h3>No Results Found</h3>
                <p>No matching CNIC found</p>
            </td>
        </tr>`;
}

function showError(msg){
    document.getElementById("results").innerHTML = `
        <tr>
            <td colspan="7" class="state">
                <div class="state-icon">‚ö†Ô∏è</div>
                <h3>Error</h3>
                <p>${msg}</p>
            </td>
        </tr>`;
    document.getElementById("resultCount").textContent = "Error";
}

function showResults(results){
    let html = `
    <tr>
        <th>Sr No</th>
        <th>CNIC</th>
        <th>Name</th>
        <th>Contact</th>
        <th>Branch Name</th>
        <th>Branch Code</th>
        <th>Batch</th>
    </tr>`;
    
    results.forEach((r, i) => {
        html += `
        <tr style="animation-delay:${i * 0.05}s">
            <td>${r[0] || "-"}</td>
            <td>${r[1] || "-"}</td>
            <td>${r[2] || "-"}</td>
            <td>${r[3] || "-"}</td>
            <td>${r[4] || "-"}</td>
            <td>${r[5] || "-"}</td>
            <td>${r[6] || "-"}</td>
        </tr>`;
    });
    
    document.getElementById("results").innerHTML = html;
}

// ===========================================
// EXPORT FUNCTIONS
// ===========================================
function copyResults(){
    if(currentResults.length === 0){
        alert('No results to copy');
        return;
    }
    
    // Transpose: Convert rows to columns
    const headers = ['Sr No', 'CNIC', 'Name', 'Contact', 'Branch Name', 'Branch Code', 'Batch'];
    let text = '';
    
    // For each header/field, create a row with all values from that field
    headers.forEach((header, index) => {
        text += header;
        currentResults.forEach(r => {
            text += '\t' + (r[index] || '-');
        });
        text += '\n';
    });
    
    navigator.clipboard.writeText(text).then(() => {
        alert('‚úì Results copied to clipboard (transposed)');
    }).catch(() => {
        alert('Failed to copy');
    });
}

function exportExcel(){
    if(currentResults.length === 0){
        alert('No results to export');
        return;
    }
    
    const ws = XLSX.utils.aoa_to_sheet([
        ['Sr No', 'CNIC', 'Applicant Name', 'Contact No', 'Branch Name', 'Branch Code', 'Batch No'],
        ...currentResults
    ]);
    
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'ACAG Results');
    XLSX.writeFile(wb, `ACAG_Search_Results_${Date.now()}.xlsx`);
}

function exportPDF(){
    if(currentResults.length === 0){
        alert('No results to export');
        return;
    }
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    doc.setFontSize(18);
    doc.text('ACAG Member Search Results', 14, 20);
    doc.setFontSize(10);
    doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 28);
    
    doc.autoTable({
        head: [['Sr No', 'CNIC', 'Name', 'Contact', 'Branch', 'Code', 'Batch']],
        body: currentResults.map(r => [r[0], r[1], r[2], r[3], r[4], r[5], r[6]]),
        startY: 35,
        styles: { fontSize: 9 }
    });
    
    doc.save(`ACAG_Results_${Date.now()}.pdf`);
}

function printResults(){
    if(currentResults.length === 0){
        alert('No results to print');
        return;
    }
    
    const printWindow = window.open('', '', 'height=600,width=800');
    printWindow.document.write('<html><head><title>ACAG Search Results</title>');
    printWindow.document.write('<style>body{font-family:Arial;padding:20px;}h2{margin-bottom:10px;color:#003d82;}p{color:#666;margin-bottom:20px;}table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:12px;text-align:left;}th{background:#003d82;color:#c59d5f;font-weight:600;}</style>');
    printWindow.document.write('</head><body>');
    printWindow.document.write('<h2>ACAG Member Search Results</h2>');
    printWindow.document.write(`<p>Generated: ${new Date().toLocaleString()}</p>`);
    printWindow.document.write('<table><thead><tr><th>Sr No</th><th>CNIC</th><th>Name</th><th>Contact</th><th>Branch Name</th><th>Branch Code</th><th>Batch</th></tr></thead><tbody>');
    
    currentResults.forEach(r => {
        printWindow.document.write(`<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td>${r[3]}</td><td>${r[4]}</td><td>${r[5]}</td><td>${r[6]}</td></tr>`);
    });
    
    printWindow.document.write('</tbody></table></body></html>');
    printWindow.document.close();
    printWindow.print();
}

function shareResults(){
    if(currentResults.length === 0){
        alert('No results to share');
        return;
    }
    
    if(navigator.share){
        navigator.share({
            title: 'ACAG Search Results',
            text: `Found ${currentResults.length} record${currentResults.length > 1 ? 's' : ''} in ACAG database`
        }).catch(() => {});
    }else{
        alert('Share feature not supported in this browser');
    }
}

// Auto-format CNIC
document.getElementById("cnicInput").addEventListener("input", e => {
    let v = e.target.value.replace(/\D/g,"").slice(0,13);
    if(v.length>5) v = v.slice(0,5)+"-"+v.slice(5);
    if(v.length>13) v = v.slice(0,13)+"-"+v.slice(13);
    e.target.value = v;
});

// Keyboard shortcuts
document.getElementById("cnicInput").addEventListener("keypress", e => {
    if(e.key === "Enter") search();
});

document.getElementById("cnicInput").addEventListener("keydown", e => {
    if(e.key === "Escape"){
        e.target.value = "";
        e.target.focus();
        document.getElementById("results").innerHTML = `
            <tr>
                <td colspan="7" class="state">
                    <div class="state-icon">üîç</div>
                    <h3>Ready to Search</h3>
                    <p>Use any search method above</p>
                </td>
            </tr>`;
        document.getElementById("resultCount").textContent = "Ready to search";
    }
});
</script>

</body>
</html>
