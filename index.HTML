<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACAG Member Search</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

:root{
    --primary:#3b82f6;
    --primary-dark:#2563eb;
    --bg:#f8fafc;
    --card:#ffffff;
    --text:#0f172a;
    --text-light:#64748b;
    --border:#e2e8f0;
    --success:#10b981;
    --error:#ef4444;
}

body{
    font-family:'Inter', sans-serif;
    background:var(--bg);
    color:var(--text);
    line-height:1.6;
    min-height:100vh;
}

.container{
    max-width:1200px;
    margin:0 auto;
    padding:40px 20px;
}

/* Header */
.header{
    text-align:center;
    margin-bottom:50px;
    opacity:0;
    animation:fadeIn 0.8s ease forwards;
}

@keyframes fadeIn{
    to{opacity:1;}
}

.logo{
    width:80px;
    height:80px;
    margin:0 auto 20px;
    background:linear-gradient(135deg, var(--primary), #8b5cf6);
    border-radius:20px;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:0 10px 30px rgba(59,130,246,0.3);
    animation:float 3s ease-in-out infinite;
}

@keyframes float{
    0%, 100%{transform:translateY(0);}
    50%{transform:translateY(-10px);}
}

.logo svg{
    width:40px;
    height:40px;
    stroke:white;
    stroke-width:2.5;
}

h1{
    font-size:2.5rem;
    font-weight:800;
    margin-bottom:10px;
    background:linear-gradient(135deg, var(--primary), #8b5cf6);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
}

.subtitle{
    color:var(--text-light);
    font-size:1.1rem;
}

/* Card */
.card{
    background:var(--card);
    border-radius:20px;
    padding:30px;
    box-shadow:0 4px 20px rgba(0,0,0,0.08);
    margin-bottom:30px;
    opacity:0;
    animation:slideUp 0.8s ease forwards;
}

@keyframes slideUp{
    from{
        opacity:0;
        transform:translateY(30px);
    }
    to{
        opacity:1;
        transform:translateY(0);
    }
}

.card:nth-child(2){animation-delay:0.1s;}
.card:nth-child(3){animation-delay:0.2s;}
.card:nth-child(4){animation-delay:0.3s;}

/* Status */
.status{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
}

.status-info{
    display:flex;
    align-items:center;
    gap:15px;
}

.status-icon{
    font-size:40px;
    animation:bounce 2s ease-in-out infinite;
}

@keyframes bounce{
    0%, 100%{transform:scale(1);}
    50%{transform:scale(1.1);}
}

.status-text h3{
    font-size:1rem;
    font-weight:600;
    margin-bottom:5px;
}

.status-text p{
    font-size:0.9rem;
    color:var(--text-light);
    font-family:'JetBrains Mono', monospace;
}

.badge{
    padding:8px 16px;
    border-radius:100px;
    font-size:0.85rem;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:8px;
}

.badge.loading{
    background:#dbeafe;
    color:var(--primary);
}

.badge.success{
    background:#d1fae5;
    color:var(--success);
}

.badge.error{
    background:#fee2e2;
    color:var(--error);
}

.spinner{
    width:14px;
    height:14px;
    border:2px solid currentColor;
    border-top-color:transparent;
    border-radius:50%;
    animation:spin 0.6s linear infinite;
}

@keyframes spin{
    to{transform:rotate(360deg);}
}

/* Search */
.search-box{
    display:flex;
    gap:12px;
}

.input-group{
    flex:1;
}

label{
    display:block;
    font-size:0.9rem;
    font-weight:600;
    margin-bottom:8px;
    color:var(--text);
}

input{
    width:100%;
    padding:14px 18px;
    font-size:1rem;
    font-family:'JetBrains Mono', monospace;
    background:var(--bg);
    border:2px solid var(--border);
    border-radius:12px;
    color:var(--text);
    transition:all 0.3s ease;
}

input:focus{
    outline:none;
    border-color:var(--primary);
    box-shadow:0 0 0 4px rgba(59,130,246,0.1);
}

button{
    align-self:flex-end;
    padding:14px 36px;
    font-size:1rem;
    font-weight:600;
    background:var(--primary);
    color:white;
    border:none;
    border-radius:12px;
    cursor:pointer;
    transition:all 0.3s ease;
    font-family:inherit;
}

button:hover{
    background:var(--primary-dark);
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(59,130,246,0.3);
}

button:active{
    transform:translateY(0);
}

button.searching{
    opacity:0.7;
    pointer-events:none;
}

/* Results */
.results-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}

.results-header h2{
    font-size:1.5rem;
    font-weight:700;
}

.count{
    color:var(--text-light);
    font-weight:600;
}

/* Table */
.table-wrapper{
    overflow-x:auto;
    border-radius:12px;
    border:1px solid var(--border);
}

table{
    width:100%;
    border-collapse:collapse;
}

thead{
    background:var(--bg);
}

th{
    padding:16px;
    text-align:left;
    font-size:0.85rem;
    font-weight:700;
    color:var(--text-light);
    text-transform:uppercase;
    letter-spacing:0.5px;
    border-bottom:2px solid var(--border);
}

tbody tr{
    border-bottom:1px solid var(--border);
    transition:background 0.2s ease;
    opacity:0;
    animation:fadeInRow 0.4s ease forwards;
}

@keyframes fadeInRow{
    to{opacity:1;}
}

tbody tr:hover{
    background:var(--bg);
}

td{
    padding:16px;
    font-size:0.95rem;
}

td:first-child{
    font-family:'JetBrains Mono', monospace;
    font-weight:600;
    color:var(--primary);
}

td:nth-child(2){
    font-family:'JetBrains Mono', monospace;
    color:var(--text);
}

/* States */
.state{
    padding:80px 40px;
    text-align:center;
}

.state-icon{
    font-size:60px;
    margin-bottom:20px;
    display:inline-block;
    animation:bounce 2s ease-in-out infinite;
}

.state h3{
    font-size:1.3rem;
    font-weight:700;
    margin-bottom:8px;
}

.state p{
    color:var(--text-light);
}

.loading-icon{
    width:60px;
    height:60px;
    border:4px solid var(--border);
    border-top-color:var(--primary);
    border-radius:50%;
    margin:0 auto 20px;
    animation:spin 0.8s linear infinite;
}

/* Responsive */
@media(max-width:768px){
    h1{font-size:2rem;}
    
    .status{
        flex-direction:column;
        text-align:center;
    }
    
    .search-box{
        flex-direction:column;
    }
    
    button{
        width:100%;
    }
    
    .results-header{
        flex-direction:column;
        align-items:flex-start;
        gap:10px;
    }
}
</style>
</head>

<body>
<div class="container">

<!-- Header -->
<div class="header">
    <div class="logo">
        <svg viewBox="0 0 24 24" fill="none">
            <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>
    <h1>ACAG Member Search</h1>
    <p class="subtitle">Search by CNIC Number</p>
</div>

<!-- Status Card -->
<div class="card">
    <div class="status">
        <div class="status-info">
            <div class="status-icon">üìä</div>
            <div class="status-text">
                <h3>Database Status</h3>
                <p id="statusInfo">Connecting...</p>
            </div>
        </div>
        <div class="badge loading" id="statusBadge">
            <span class="spinner"></span>
            <span>Loading</span>
        </div>
    </div>
</div>

<!-- Search Card -->
<div class="card">
    <div class="search-box">
        <div class="input-group">
            <label>Enter CNIC Number</label>
            <input 
                type="text" 
                id="cnicInput"
                placeholder="XXXXX-XXXXXXX-X"
                maxlength="15"
                autocomplete="off"
            >
        </div>
        <button id="searchBtn" onclick="search()">
            <span id="btnText">üîç Search</span>
        </button>
    </div>
</div>

<!-- Results Card -->
<div class="card">
    <div class="results-header">
        <h2>Results</h2>
        <div class="count" id="resultCount">Ready</div>
    </div>
    
    <div class="table-wrapper">
        <table>
            <tbody id="results">
                <tr>
                    <td colspan="7" class="state">
                        <div class="state-icon">üîç</div>
                        <h3>Ready to Search</h3>
                        <p>Enter CNIC number above</p>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

</div>

<script>
// Config
const SHEET_ID = "1WxFeeRY5X8KaMAmZjogReKFHZaWi8We3";
const SHEET_NAME = "Sheet1";

// State
let data = [];
let ready = false;

// Initialize
window.onload = async () => {
    await loadData();
    document.getElementById("cnicInput").focus();
};

// Load data
async function loadData(){
    const badge = document.getElementById("statusBadge");
    const info = document.getElementById("statusInfo");
    
    try{
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
        const start = performance.now();
        
        const res = await fetch(url);
        if(!res.ok) throw new Error("Failed");
        
        const csv = await res.text();
        const time = Math.round(performance.now() - start);
        
        data = parseCSV(csv);
        ready = true;
        
        const count = data.length - 1;
        badge.className = "badge success";
        badge.innerHTML = '<span>‚úì</span><span>Connected</span>';
        info.textContent = `${count.toLocaleString()} records ‚Ä¢ ${time}ms`;
        
    }catch(err){
        badge.className = "badge error";
        badge.innerHTML = '<span>‚ö†</span><span>Failed</span>';
        info.textContent = "Connection failed";
    }
}

// Parse CSV
function parseCSV(csv){
    return csv.split("\n").filter(l => l.trim()).map(line => {
        const cells = [];
        let cell = '';
        let quoted = false;
        
        for(let i = 0; i < line.length; i++){
            const c = line[i];
            if(c === '"'){
                quoted = !quoted;
            }else if(c === ',' && !quoted){
                cells.push(cell.trim());
                cell = '';
            }else{
                cell += c;
            }
        }
        cells.push(cell.trim());
        return cells;
    });
}

// Search
function search(){
    if(!ready){
        showError("Data not loaded");
        return;
    }
    
    const input = document.getElementById("cnicInput").value.trim();
    const btn = document.getElementById("searchBtn");
    const btnText = document.getElementById("btnText");
    const count = document.getElementById("resultCount");
    
    const cnic = input.replace(/\D/g, "");
    
    if(cnic.length !== 13){
        showError("Enter valid 13-digit CNIC");
        return;
    }
    
    btn.classList.add("searching");
    btnText.textContent = "‚è≥ Searching";
    showLoading();
    
    setTimeout(() => {
        const start = performance.now();
        const results = data.slice(1).filter(r => r[1].replace(/\D/g, "") === cnic);
        const time = Math.round(performance.now() - start);
        
        btn.classList.remove("searching");
        btnText.textContent = "üîç Search";
        
        if(results.length === 0){
            showNoResults();
            count.textContent = "No results";
        }else{
            showResults(results);
            count.textContent = `${results.length} found ‚Ä¢ ${time}ms`;
        }
    }, 200);
}

// Display functions
function showLoading(){
    document.getElementById("results").innerHTML = `
        <tr>
            <td colspan="7" class="state">
                <div class="loading-icon"></div>
                <h3>Searching...</h3>
                <p>Please wait</p>
            </td>
        </tr>`;
}

function showNoResults(){
    document.getElementById("results").innerHTML = `
        <tr>
            <td colspan="7" class="state">
                <div class="state-icon">‚ùå</div>
                <h3>No Results</h3>
                <p>No matching CNIC found</p>
            </td>
        </tr>`;
}

function showError(msg){
    document.getElementById("results").innerHTML = `
        <tr>
            <td colspan="7" class="state">
                <div class="state-icon">‚ö†Ô∏è</div>
                <h3>Error</h3>
                <p>${msg}</p>
            </td>
        </tr>`;
    document.getElementById("resultCount").textContent = "Error";
}

function showResults(results){
    let html = `
        <tr>
            <th>Sr No</th>
            <th>CNIC</th>
            <th>Name</th>
            <th>Contact</th>
            <th>Branch Name</th>
            <th>Branch Code</th>
            <th>Batch</th>
        </tr>`;
    
    results.forEach((r, i) => {
        html += `
        <tr style="animation-delay:${i * 0.05}s">
            <td>${r[0] || "-"}</td>
            <td>${r[1] || "-"}</td>
            <td>${r[2] || "-"}</td>
            <td>${r[3] || "-"}</td>
            <td>${r[4] || "-"}</td>
            <td>${r[5] || "-"}</td>
            <td>${r[6] || "-"}</td>
        </tr>`;
    });
    
    document.getElementById("results").innerHTML = html;
}

// Auto-format CNIC
document.getElementById("cnicInput").addEventListener("input", e => {
    let v = e.target.value.replace(/\D/g, "").slice(0, 13);
    if(v.length > 5) v = v.slice(0, 5) + "-" + v.slice(5);
    if(v.length > 13) v = v.slice(0, 13) + "-" + v.slice(13);
    e.target.value = v;
});

// Keyboard events
document.getElementById("cnicInput").addEventListener("keypress", e => {
    if(e.key === "Enter") search();
});

document.getElementById("cnicInput").addEventListener("keydown", e => {
    if(e.key === "Escape"){
        e.target.value = "";
        e.target.focus();
        document.getElementById("results").innerHTML = `
            <tr>
                <td colspan="7" class="state">
                    <div class="state-icon">üîç</div>
                    <h3>Ready to Search</h3>
                    <p>Enter CNIC number above</p>
                </td>
            </tr>`;
        document.getElementById("resultCount").textContent = "Ready";
    }
});
</script>

</body>
</html>
