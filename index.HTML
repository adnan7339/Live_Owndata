<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACAG Batch Data Search</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

:root{
    --bg:#fafafa;
    --surface:#ffffff;
    --surface-elevated:#f5f5f5;
    --primary:#0066ff;
    --primary-hover:#0052cc;
    --text:#0a0a0a;
    --text-light:#737373;
    --text-lighter:#a3a3a3;
    --border:#e5e5e5;
    --border-dark:#d4d4d4;
    --success:#16a34a;
    --error:#dc2626;
    --shadow-sm:0 1px 2px rgba(0,0,0,0.04);
    --shadow:0 4px 12px rgba(0,0,0,0.08);
    --shadow-lg:0 12px 32px rgba(0,0,0,0.12);
    --radius:12px;
    --radius-lg:16px;
    --transition:all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}

body{
    font-family:'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    background:var(--bg);
    color:var(--text);
    line-height:1.6;
    min-height:100vh;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
}

/* Container */
.container{
    max-width:1280px;
    margin:0 auto;
    padding:32px 24px;
}

/* Header */
.header{
    text-align:center;
    margin-bottom:48px;
    animation:fadeIn 0.6s ease-out;
}

@keyframes fadeIn{
    from{opacity:0; transform:translateY(-20px);}
    to{opacity:1; transform:translateY(0);}
}

.logo{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:64px;
    height:64px;
    background:linear-gradient(135deg, var(--primary), #00b8d4);
    border-radius:16px;
    margin-bottom:20px;
    box-shadow:var(--shadow-lg);
    animation:logoFloat 3s ease-in-out infinite;
}

@keyframes logoFloat{
    0%, 100%{transform:translateY(0);}
    50%{transform:translateY(-8px);}
}

.logo svg{
    width:32px;
    height:32px;
    stroke:white;
    stroke-width:2.5;
}

.header h1{
    font-size:2.5rem;
    font-weight:700;
    color:var(--text);
    margin-bottom:8px;
    letter-spacing:-0.02em;
}

.header p{
    font-size:1.125rem;
    color:var(--text-light);
    font-weight:500;
}

/* Status Bar */
.status-bar{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:20px 28px;
    margin-bottom:32px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow:var(--shadow-sm);
    animation:slideUp 0.6s ease-out 0.1s both;
}

@keyframes slideUp{
    from{opacity:0; transform:translateY(20px);}
    to{opacity:1; transform:translateY(0);}
}

.status-info{
    display:flex;
    align-items:center;
    gap:16px;
}

.status-icon{
    width:48px;
    height:48px;
    background:linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
}

.status-text h3{
    font-size:1rem;
    font-weight:600;
    color:var(--text);
    margin-bottom:4px;
}

.status-text p{
    font-size:0.875rem;
    font-family:'IBM Plex Mono', monospace;
    color:var(--text-lighter);
}

.status-badge{
    padding:8px 16px;
    background:#dcfce7;
    color:var(--success);
    border-radius:100px;
    font-size:0.875rem;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:8px;
}

.status-badge.loading{
    background:#dbeafe;
    color:var(--primary);
}

.spinner{
    width:14px;
    height:14px;
    border:2px solid currentColor;
    border-top-color:transparent;
    border-radius:50%;
    animation:spin 0.6s linear infinite;
}

@keyframes spin{
    to{transform:rotate(360deg);}
}

/* Search Section */
.search-section{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:32px;
    margin-bottom:32px;
    box-shadow:var(--shadow-sm);
    animation:slideUp 0.6s ease-out 0.2s both;
}

/* Search Form */
.search-form{
    display:flex;
    gap:12px;
}

.search-input-wrapper{
    flex:1;
}

.search-label{
    display:block;
    font-size:0.875rem;
    font-weight:600;
    color:var(--text);
    margin-bottom:8px;
}

.search-input{
    width:100%;
    padding:14px 18px;
    font-size:1rem;
    font-family:'IBM Plex Mono', monospace;
    font-weight:500;
    background:var(--surface-elevated);
    border:2px solid var(--border);
    border-radius:var(--radius);
    color:var(--text);
    transition:var(--transition);
}

.search-input:focus{
    outline:none;
    border-color:var(--primary);
    background:var(--surface);
    box-shadow:0 0 0 4px rgba(0,102,255,0.08);
}

.search-input::placeholder{
    color:var(--text-lighter);
}

.search-btn{
    align-self:flex-end;
    padding:14px 32px;
    font-size:1rem;
    font-weight:600;
    background:var(--primary);
    color:white;
    border:none;
    border-radius:var(--radius);
    cursor:pointer;
    transition:var(--transition);
    font-family:inherit;
    box-shadow:var(--shadow);
    white-space:nowrap;
}

.search-btn:hover{
    background:var(--primary-hover);
    transform:translateY(-2px);
    box-shadow:var(--shadow-lg);
}

.search-btn:active{
    transform:translateY(0);
}

.search-btn.searching{
    opacity:0.7;
    cursor:not-allowed;
}

/* Results Section */
.results-section{
    animation:slideUp 0.6s ease-out 0.3s both;
}

.results-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
}

.results-title{
    font-size:1.5rem;
    font-weight:700;
    color:var(--text);
}

.results-count{
    font-size:0.9375rem;
    font-weight:600;
    color:var(--text-light);
    padding:8px 16px;
    background:var(--surface-elevated);
    border-radius:100px;
}

/* Table */
.table-container{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    overflow:hidden;
    box-shadow:var(--shadow-sm);
}

.table-wrapper{
    overflow-x:auto;
}

table{
    width:100%;
    border-collapse:collapse;
}

thead{
    background:var(--surface-elevated);
    border-bottom:1px solid var(--border);
}

th{
    padding:16px 20px;
    text-align:left;
    font-size:0.875rem;
    font-weight:700;
    color:var(--text);
    text-transform:uppercase;
    letter-spacing:0.5px;
    white-space:nowrap;
}

tbody tr{
    border-bottom:1px solid var(--border);
    transition:background 0.15s ease;
    animation:fadeInRow 0.3s ease-out backwards;
}

@keyframes fadeInRow{
    from{opacity:0; transform:translateX(-10px);}
    to{opacity:1; transform:translateX(0);}
}

tbody tr:hover{
    background:var(--surface-elevated);
}

tbody tr:last-child{
    border-bottom:none;
}

td{
    padding:16px 20px;
    font-size:0.9375rem;
    color:var(--text);
}

td:first-child{
    font-family:'IBM Plex Mono', monospace;
    font-weight:600;
    color:var(--primary);
}

/* State Styles */
.empty-state,
.loading-state,
.error-state{
    padding:64px 32px;
    text-align:center;
}

.state-icon{
    width:64px;
    height:64px;
    margin:0 auto 20px;
    background:var(--surface-elevated);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:32px;
}

.error-state .state-icon{
    background:#fee2e2;
    color:var(--error);
}

.loading-spinner{
    width:48px;
    height:48px;
    margin:0 auto 20px;
    border:4px solid var(--border);
    border-top-color:var(--primary);
    border-radius:50%;
    animation:spin 0.8s linear infinite;
}

.state-title{
    font-size:1.25rem;
    font-weight:700;
    color:var(--text);
    margin-bottom:8px;
}

.state-text{
    font-size:1rem;
    color:var(--text-light);
}

/* Responsive */
@media(max-width:768px){
    .container{
        padding:20px 16px;
    }
    
    .header h1{
        font-size:2rem;
    }
    
    .status-bar{
        flex-direction:column;
        gap:16px;
        text-align:center;
    }
    
    .search-form{
        flex-direction:column;
    }
    
    .search-btn{
        width:100%;
    }
    
    .results-header{
        flex-direction:column;
        align-items:flex-start;
        gap:12px;
    }
    
    table{
        font-size:0.875rem;
    }
    
    th, td{
        padding:12px 16px;
    }
}

/* Print Styles */
@media print{
    body{
        background:white;
    }
    
    .search-section,
    .status-bar{
        display:none;
    }
}
</style>
</head>

<body>
<div class="container">

<!-- Header -->
<div class="header">
    <div class="logo">
        <svg viewBox="0 0 24 24" fill="none">
            <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>
    <h1>ACAG Member Search</h1>
    <p>Search by CNIC Number</p>
</div>

<!-- Status Bar -->
<div class="status-bar">
    <div class="status-info">
        <div class="status-icon">üìä</div>
        <div class="status-text">
            <h3>Database Connection</h3>
            <p id="sheetInfo">Connecting...</p>
        </div>
    </div>
    <div class="status-badge loading" id="statusBadge">
        <span class="spinner"></span>
        <span>Loading</span>
    </div>
</div>

<!-- Search Section -->
<div class="search-section">
    <div class="search-form">
        <div class="search-input-wrapper">
            <label class="search-label">Enter CNIC Number</label>
            <input 
                type="text" 
                id="searchInput" 
                class="search-input"
                placeholder="XXXXX-XXXXXXX-X"
                maxlength="15"
                autocomplete="off"
            >
        </div>
        <button class="search-btn" id="searchBtn" onclick="searchData()">
            <span id="btnText">üîç Search</span>
        </button>
    </div>
</div>

<!-- Results Section -->
<div class="results-section">
    <div class="results-header">
        <h2 class="results-title">Results</h2>
        <div class="results-count" id="resultsCount">Ready</div>
    </div>
    
    <div class="table-container">
        <div class="table-wrapper">
            <table>
                <tbody id="resultTable">
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div class="state-icon">üîç</div>
                            <h3 class="state-title">Ready to Search</h3>
                            <p class="state-text">Enter CNIC number above to search</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

</div>

<script>
// ==================== CONFIG ====================
const SHEET_ID = "1WxFeeRY5X8KaMAmZjogReKFHZaWi8We3";
const SHEET_NAME = "Sheet1";

// ==================== STATE ====================
let data = [];
let loaded = false;

// ==================== INITIALIZATION ====================
window.onload = async () => {
    await loadData();
    document.getElementById("searchInput").focus();
};

// ==================== DATA LOADING ====================
async function loadData(){
    const badge = document.getElementById("statusBadge");
    const info = document.getElementById("sheetInfo");
    
    try{
        badge.className = "status-badge loading";
        badge.innerHTML = '<span class="spinner"></span><span>Connecting</span>';
        info.textContent = "Establishing connection...";
        
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
        const start = performance.now();
        
        const response = await fetch(url, {
            method: 'GET',
            cache: 'default',
            mode: 'cors'
        });
        
        if(!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const csv = await response.text();
        const time = Math.round(performance.now() - start);
        
        data = parseCSV(csv);
        loaded = true;
        
        const count = data.length - 1;
        badge.className = "status-badge";
        badge.innerHTML = '<span>‚úì</span><span>Connected</span>';
        info.textContent = `${count.toLocaleString()} records ‚Ä¢ ${time}ms`;
        
        console.log(`‚úì Loaded ${count} records in ${time}ms`);
        
    }catch(err){
        console.error("Load error:", err);
        badge.className = "status-badge";
        badge.style.background = "#fee2e2";
        badge.style.color = "var(--error)";
        badge.innerHTML = '<span>‚ö†</span><span>Failed</span>';
        info.textContent = "Connection failed";
    }
}

// ==================== CSV PARSER ====================
function parseCSV(csv){
    const lines = csv.split("\n").filter(l => l.trim());
    return lines.map(line => {
        const cells = [];
        let cell = '';
        let quoted = false;
        
        for(let i = 0; i < line.length; i++){
            const c = line[i];
            const next = line[i + 1];
            
            if(c === '"'){
                if(quoted && next === '"'){
                    cell += '"';
                    i++;
                }else{
                    quoted = !quoted;
                }
            }else if(c === ',' && !quoted){
                cells.push(cell.trim());
                cell = '';
            }else{
                cell += c;
            }
        }
        cells.push(cell.trim());
        return cells;
    });
}

// ==================== NORMALIZE ====================
function normNum(val){
    return String(val || "").replace(/\D/g, "");
}

// ==================== SEARCH ====================
function searchData(){
    if(!loaded){
        showError("Data not loaded. Please wait...");
        return;
    }
    
    const input = document.getElementById("searchInput").value.trim();
    const btn = document.getElementById("searchBtn");
    const btnText = document.getElementById("btnText");
    const count = document.getElementById("resultsCount");
    
    const cnic = normNum(input);
    
    if(cnic.length !== 13){
        showError("Please enter valid 13-digit CNIC");
        return;
    }
    
    btn.classList.add("searching");
    btnText.textContent = "‚è≥ Searching";
    showLoading();
    
    setTimeout(() => {
        const start = performance.now();
        const rows = data.slice(1);
        const results = rows.filter(r => normNum(r[1]) === cnic);
        const time = Math.round(performance.now() - start);
        
        btn.classList.remove("searching");
        btnText.textContent = "üîç Search";
        
        if(results.length === 0){
            showNoResults();
            count.textContent = "No results";
        }else{
            displayResults(results);
            count.textContent = `${results.length} found (${time}ms)`;
        }
        
        console.log(`Search: ${results.length} results in ${time}ms`);
    }, 300);
}

// ==================== DISPLAY FUNCTIONS ====================
function showLoading(){
    const table = document.getElementById("resultTable");
    table.innerHTML = `
        <tr>
            <td colspan="7" class="loading-state">
                <div class="loading-spinner"></div>
                <h3 class="state-title">Searching...</h3>
                <p class="state-text">Processing query</p>
            </td>
        </tr>`;
}

function showNoResults(){
    const table = document.getElementById("resultTable");
    table.innerHTML = `
        <tr>
            <td colspan="7" class="error-state">
                <div class="state-icon">‚ùå</div>
                <h3 class="state-title">No Results</h3>
                <p class="state-text">No matching CNIC found in database</p>
            </td>
        </tr>`;
}

function showError(msg){
    const table = document.getElementById("resultTable");
    const count = document.getElementById("resultsCount");
    table.innerHTML = `
        <tr>
            <td colspan="7" class="error-state">
                <div class="state-icon">‚ö†Ô∏è</div>
                <h3 class="state-title">Error</h3>
                <p class="state-text">${msg}</p>
            </td>
        </tr>`;
    count.textContent = "Error";
}

function displayResults(results){
    const table = document.getElementById("resultTable");
    
    let html = `
    <tr>
        <th>Sr No</th>
        <th>CNIC</th>
        <th>Name</th>
        <th>Contact</th>
        <th>Branch Name</th>
        <th>Branch Code</th>
        <th>Batch</th>
    </tr>`;
    
    results.forEach((r, i) => {
        html += `
        <tr style="animation-delay:${i * 0.03}s">
            <td>${r[0] || "-"}</td>
            <td>${r[1] || "-"}</td>
            <td>${r[2] || "-"}</td>
            <td>${r[3] || "-"}</td>
            <td>${r[4] || "-"}</td>
            <td>${r[5] || "-"}</td>
            <td>${r[6] || "-"}</td>
        </tr>`;
    });
    
    table.innerHTML = html;
}

// ==================== AUTO-FORMAT CNIC ====================
document.getElementById("searchInput").addEventListener("input", e => {
    let v = e.target.value.replace(/\D/g, "").slice(0, 13);
    if(v.length > 5) v = v.slice(0, 5) + "-" + v.slice(5);
    if(v.length > 13) v = v.slice(0, 13) + "-" + v.slice(13);
    e.target.value = v;
});

// ==================== KEYBOARD EVENTS ====================
document.getElementById("searchInput").addEventListener("keypress", e => {
    if(e.key === "Enter"){
        e.preventDefault();
        searchData();
    }
});

document.getElementById("searchInput").addEventListener("keydown", e => {
    if(e.key === "Escape"){
        e.target.value = "";
        e.target.focus();
        const table = document.getElementById("resultTable");
        const count = document.getElementById("resultsCount");
        table.innerHTML = `
            <tr>
                <td colspan="7" class="empty-state">
                    <div class="state-icon">üîç</div>
                    <h3 class="state-title">Ready to Search</h3>
                    <p class="state-text">Enter CNIC number above to search</p>
                </td>
            </tr>`;
        count.textContent = "Ready";
    }
});
</script>

</body>
</html>
